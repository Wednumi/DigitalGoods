@using DigitalGoods.Core.Services.TagServices

@inject TagCreator TagCreator

<EditForm class="d-inline-flex" Model="_tagModel" OnValidSubmit="AddCreatedAsync">
    <DataAnnotationsValidator />
    <div class="overlay-info">
        <div class="me-1 my-auto">Category</div>
        <input class="form-control" type="text" placeholder="@CategoryTagsRelation.Category?.Name" readonly />
    </div>
    <div class="overlay-info">
        <div class="me-2 my-auto">Enter new tag</div>
        <InputText @bind-Value="_tagModel.Name" class="form-control" placeholder="Tag name" />
    </div>
    <div class="item-btn d-flex flex-row">
        <div class="item-accept d-flex align-items-stretch">
            <InputItem type="submit" value="Add"></InputItem>
        </div>
    </div>
</EditForm>

@code {
    private TagModel _tagModel = new TagModel();

    [Parameter]
    public CategoryTagsRelation CategoryTagsRelation { get; set; }

    private async Task AddCreatedAsync()
    {
        var created = await Create();
        CategoryTagsRelation.Tags.Add(created);
        _tagModel = new TagModel();
    }

    private async Task<Tag> Create()
    {
        var tag = new Tag(_tagModel.Name, CategoryTagsRelation.Category);
        await TagCreator.CreateAsync(tag);
        return tag;
    }
}